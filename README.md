# AIGameTranslater
Сделано мной совместно с Чатом ГПТ. ОЧЕНЬ РАННЯЯ ВЕРСИЯ, СКОРЕЕ ДАЖЕ НАРАБОТКА ДЛЯ ПРИКОЛА
- Немного истории: Мне просто надоело напрягать мозги или сидеть с переводчиком и переводить азиатские гача игры и визуальные новелы, поэтому я напечатал эту прогу (не совсем я, но руку точно приложил в некоторых местах)
## ОПИСАНИЕ (желательно всё прочитать, даже мою болтовню)
Локальный AI переводчик использующий ресурсы ПК для перевода игр и другово рода контента. Работает по принципу: Раз в 1-2 секунды (можно настроить) делает скриншот области -> отправляет скриншот нейросети -> нейросеть распознает текст и переводит на русский -> выводит текст на экран (Profit)
## МИНИМАЛЬНЫЕ СИСТЕМНЫЕ ТРЕБОВАНИЯ (что бы хоть что-то показало/перевело и было комфортно):
- GPU: RTX с 8 ГБ VRAM. (RTX 2060 SUPER)
- ОЗУ: 16 ГБ .
- CPU: любой 6–8 ядер.
- Диск: модель + mmproj ≈ 6–8 ГБ суммарно.

Так же внизу будут тесты на моем ПК

А вы что думали, будет все радужно? Можно еще хуже (легче) модель поставить, но качество перевода оставит желать лучшего.
Конечно есть аналоги более щадящие по железу (хотя с легкими моделями будет примерно тоже самое), я и сам изначально пробовал его сделать, но мне абсолютно не понравилось как оно переводит и как работает впринципе. Почти всегда текст похожий на "Она - со мной, углепластик...", ну вы поняли. Распознавание текста тоже хромает так еще и на GPU завести проблематично, а на CPU я видел нагрузку 102%... Поэтому вариант с AI меня более чем устраивает. (В самом низу покажу нагрузку и что у меня стоит)

### УСТАНОВКА
1) Скачать
2) Распаковать в удобное место (желательно на SSD и в папку без русских символов)
3) Запустить

### НАСТРОЙКА
#### При запуске появится огромное окно с настройками (оно необходимо для более тонкой настройки для каждой конфигурации ПК) и область, которая будет переводить и выводить перевод, область можно перемещать, увеличивать, уменьшать, разделять, добавлять.
<img width="972" height="1386" alt="image" src="https://github.com/user-attachments/assets/c6150d5d-477d-422d-8987-a7a5f160c34b" />


#### 1)Кнопка "Начать перевод" 
- запускает сервер с AI и начинает захватывать и переводить текст под областью
<img width="2546" height="1427" alt="image" src="https://github.com/user-attachments/assets/8be93fd9-c022-478b-b294-2163ef329132" />

<img width="2300" height="596" alt="Снимок экрана 2025-11-06 015847" src="https://github.com/user-attachments/assets/3c0ab082-d883-4a9b-b496-dc05f042fc97" />

#### 2) Чуть ниде есть переключатель для соло и даул режима. 
- При нажатом переключателе имеется возможность использовать две отдельные модели. Одна для распознавания текста, вторая для перевода. При правильно комбинации моделей это может улучшить качество перевода и снизить нагрузку на систему. Но придется поэксперементировать. Для простого пути можно использовать соло режим (одня модель для всего)
<img width="960" height="1043" alt="image" src="https://github.com/user-attachments/assets/0a57d9c8-502c-47b2-ae92-d3eb6995d87d" />


#### 3) Окно для захвата
- выберите процесс игры или необходимой программы
<img width="975" height="81" alt="image" src="https://github.com/user-attachments/assets/75ca17b9-448d-4670-b088-52e0d8e37f4f" />

#### 4) Модели 
- Выберите необходимые модели (Для соло режима только две: VL модель и mmproj модель. Для дуо три: VL модель и mmproj для чтение текста и простая для перевода). В самом низу есть кнопка для скачивания моделей
- Соло
<img width="962" height="112" alt="image" src="https://github.com/user-attachments/assets/f629f7f6-d263-47ee-b8b3-1787697d0697" />

- Дуо (тут же сразу и настраивайте кждую модель отдельно)
<img width="959" height="890" alt="image" src="https://github.com/user-attachments/assets/10065871-e869-4b39-8fee-466e610f3a93" />

#### 5) Лор файл и "Фразбук"
- небольшой сборник терминов для нейросети, что бы она правильно переводила имена (определяла их пол, если персонаж женщина, а так же подстраивала перевод под нее), термины, фракции, организации и т.д. Можете сделать сами или с помощью той же онлайн нейросети попросить создать его (напишите примерно: Дай краткое описание всех персонажей (пол и т.д), терминов, фракций, организаций и т.д игры "название игры", а так же перевод всего этого с английского на русский (или другой интересующий вас язык, перевод с поднебесной и других языков поддерживается). Если лора нет, оставьте пустым (перевод может ухудшиться). Тоже самое и с "ФРазбуком", я использую его для помощи с переводом некоторых спорных моментов (помогает избавиться от "я твоя не понимать" По умолчанию находится в "GameTranslator/_internal/assets"
<img width="944" height="142" alt="image" src="https://github.com/user-attachments/assets/ed08a76d-78d8-461b-aaba-fc89bbb6f55d" />

<img width="467" height="335" alt="Снимок экрана 2025-11-07 003407" src="https://github.com/user-attachments/assets/92816f08-c148-485e-b4c1-ce0ac2393327" />

#### 6) Смена шрифта, его размера и толщина
- тут всё просто (не спрашивайте почему там "гарнитура" я сам не знаю, пока лень исправлять), там все шрифты в вашей системе, выбирайте любой и подгоняйте размер как вам нужно.
<img width="953" height="134" alt="image" src="https://github.com/user-attachments/assets/21381840-5128-4ca6-bf97-d9b2f8597a19" />


### ВСЕ ЧТО ИДЕТ ДАЛЬШЕ ВЛИЯЕТ НА ВАШУ ПРОИЗВОДИТЕЛЬНОСТЬ И РАБОТУ ИИ В ЦЕЛОМ, В КОНЦЕ Я ДАМ НЕБОЛЬШУЮ СВОДКУ, ЧТО ЗА ЧТО ОТВЕЧАЕТ КАКОЕ ВЛИЯНИЕ НА ПРОИЗВОДИТЕЛЬНОСТЬ И РАБОТУ ИИ. ДЛЯ ДУО РЕЖИМА ЗНАЧЕНИЯ ДЕЛИТЕ НА 2 ДЛЯ КАЖДОЙ МОДЕЛИ (ИСКЛЮЧЕНИЕМ ЯВЛЯЮТСЯ МАКС.ТОКЕНЫ И КОНТЕКСТ (CTX-SIZE), ЕСЛИ В СОЛО БЫЛО ТОКЕНОВ 1500, ТО ДЛЯ ПЕРЕВОДА ОСТАВЬТЕ 1000, А ДЛЯ ГЛЯДЕЛКИ 500. ЗНАЧЕНИЕ КОНТЕКСТА ПЕРЕХОДИТ ПОЛНОСТЬ В ПЕРЕВОДЧИК ТАК КАК ДЛЯ ЗАРУЗКИ ЛОРА И ФРАЗБУКА НУЖНО БОЛЬШОЕ ЗНАЧЕНИЕ. ДЛЯ ГЛЯДЕЛКИ ОСТАВЬТЕ 4000 ИЛИ 8000 (ЕСЛИ НЕ ХВАТАЕТ)). ОСТАВЬТЕ ПОКА ЗНАЧЕНИЯ ПО УМОЛЧАНИЮ, ЕСЛИ БУДЕТ ПЕЧАЛЬНО ПОНИЖАЙТЕ НЕМНОГО КАЖДЫЙ ПАРАМЕТР.

#### 7) Настройка модели
- максимум токенов = максимальный размер ответа AI
- timeout - максимальное время овета AI, если не справился сбрасывает ответ и по новой думает (если словил жесткий затуп может помочь)
- temperature - "креативность" AI
- top_p - та же "креативность", но в другом плане.
#### 8) Доп. параметры генерации
- top_k - еще одна "креативность" (да, ее нужно много, что бы ограничивать или наоборот дать простор в переводе)
- repeat_penalty - БОЛЬШЕ КРЕАТИВНОСТИ
- seed - не смешно уже, опять креативность
- slot_id - место для вашего лора и промпта, по умолчанию 0, пусть и отсается 0.
- cache_promt - загружается ли промпт+лор в память. Пусть всегда включено, если не используете иначе
#### 9) Сервер llama
- ctx-size - Сколько токенов уместится в запросе+истории
- batch-size - размер партии токенов на шаге. Влияет на пропускную способность и немного на VRAM
- ubatch-size - подпартия, главный «жир» по VRAM
- parralel - параллельные запросы к серверу. Для нескольких областей может ускорять, но VRAM растёт почти линейно.
- ngl - ниже = меньше жор GPU. Выше = больше жор на GPU. Всё просто. можете оставить 999 и проверить как работает (будет брать столько, сколько ему надо, не больше).
- host - не трогайте, если не знаете как
- port - то же самое
#### 10) Константы
- FPS захвата - больше = чаще происходит скрин на отправку, меньше = реже. По умолчанию 1 = 1 скрин в секунду. Меняйте по своему усмотрению
- Плавный вывод - если включен = режим новеллы, текст появляется плавно (скорость меняется стрелочками вверх или вних), если выключен = появляется сразу по мере поступления текста
- Размер ручек,рамки - позволяет менять размер уголков для растягивания области.
#### 11) Настроить промпт
- позволяет в ручную настраивать промпт для нейросети. (для дуо режима находится где выбирается модель)
#### 12) Предпросмотр промпта
- показывает текущий промпт. Мной уже загружен промпт, можете использовать его как шаблон для своего.
### ГЛАВНОЕ ЕСЛИ ВЫ МЕНЯЕТЕ ПРОМПТ И ИСПОЛЬЗУЕТЕ ФАЙЛ ЛОРА ИЛИ ФРАЗБУКА ТО В КОНЦЕ ЯБАЗАТЕЛЬНО СДЕЛАЙТЕ ТАК, ИНАЧЕ ЛОР/ФРАЗБУК НЕ СРАБОТАЕТ:
- === LORE START ===
{{LORE}}
=== LORE END ===

- === PHRASEBOOK START ===
{{PHRASEBOOK}}
=== PHRASEBOOK END ===

<img width="1298" height="1213" alt="image" src="https://github.com/user-attachments/assets/6f0b8090-1e19-4f29-9fa5-95baf0ba3f44" />

#### 13) Скачать модели
- Можно скачать модели прямо тут, можно вставить ссылку на модель или выбрать уже из списка, я добавил и рассписал какая модель к чему
<img width="1268" height="548" alt="image" src="https://github.com/user-attachments/assets/51188498-d72b-4fe7-b1c9-953a9e776400" />

- Что бы скачать модель из списка: Нижмиет на модель, нажмите на кнопку "из пресета", нажмите "Скачать". Модель начнет скачиваться в нужную папку сама и по окончанию загрузки отобразится в выборе модели
- Что бы скачать модель по ссылке: Вставьте ссылку на модель, нажмите "Скачать". Модель начнет скачиваться в нужную папку сама и по окончанию загрузки отобразится в выборе модели


#### 14) Настройка самой области
- Потяните за любой уголок что бы растянуть/стянуть область.
- Потяните за рамку, что бы перенести область
- CTRL+ALT+N - создать новую область
- CTRL+ALT+D - разделить область на две отдельные, область захвата (оранжевая) и область перевода (синяя). И так же что бы соединить обратно
- TAB - сменить редактирование между захватом и переводом
- Delete (перед этим нажнмите на нужную область) - удалить область
- CTRL+ALT+F1 - полностю скрыть область
- CRTL+ALT+F2 - скрыть только рамки (оставить размытый фон)
- CTRL+ALT+Q - выход в настройки

Пока что это все настройки что есть, возможно что-то добавится, а что-то уберется.


После всех настроек и изменений области под себя, жмите кнопку "Начать перевод", через некоторое время, если все сделали правильно, появится перевод текста.
### ПОМНИТЕ, ЧТО ЭТО Я ВСЁ ДЕЛАЛ ДЛЯ СЕБЯ И ПРОСТО РЕШИЛ ПОДЕЛИТЬСЯ СО ВСЕМИ, ТАК ЧТО ВОЗМОЖНЫ ОШИБКИ. ТАК ЧТО ПИШИТЕ О БАГАХ, НЕДОРАБОТКАХ, БУДУ ИСПРАВЛЯТЬ ПО ВОЗМОЖНОСТИ. ЕСЛИ ВЫ ЗНАЕТ КАК МОЖНО ДОРАБОТАТЬ ТОТ ИЛИ ИНОЙ АСПЕКТ ПРОГРАММЫ БУДУ ПРИЗНАТЕЛЕН.

### ИЗВЕСТНЫЕ ОШИБКИ:
1) Самая главная ошибка в том, что оно существует
2) Текст бывает "обновляется", то есть постоянно начинает печататься заново в режиме плавного появления. Это из-за того, что нейросеть пытается выдать один и тот же текст по разному (где-то слово другое использует, где-то знаки меняет и т.д), можете попрбовать убавить ее кративность, но тогда возможно пострадает перевод.
3) Дурацкая рамка хватается не с первого раза

### ЧТО ХОЧУ СДЕЛАТЬ:
2) Возможность сменить сервер. Сейчас используется llama, для меня это самое простое решение и в ней есть модели "все в одном"
3) Больше настроек для комфорта

### КАК И ОБЕЩАЛ БОЛЕЕ ДЕТАЛЬНОЕ ОПИСАНИЕ ДЛЯ НАСТРОЕК И ПРИМЕРНЫЕ ПРЕСЕТЫ ДЛЯ ОБЫЧНОГО ПК:

1) Модель
- Минимальная связка для соло и дуо:
- Соло: Qwen-VL-4B + mmproj F16 (минимальная нагрузка и так себе перевод)
- Дуо: (Qwen-VL-2B + mmproj F16) + Qwen-4B (без VL) (Нагрузка чуть больше, но повторов должно быть меньше)


- Средняя свяка для соло и дуо:
- Соло Qwen-VL-8B + mmproj F16 (Умеренная нагрузка и нормальный перевод (возможны повтор/обновление текста)
- Дуо (Qwen-VL-2B + mmproj) + Qwen-8B (без VL) (Нагрузка чуть выше, но повторов меньше)


- Можно вообще попробовать всё на Qwen-VL-2B запустить, получится потраченый перевод из GTA:SA, но зато нагрузка еще меньше


2) ctx-size (контекст)
- Сколько токенов уместится в запросе+истории. ↑ctx = ↑VRAM/KV-кеш, стабильнее длинные сцены.
- Средне: 6144–8192 (8 GB VRAM) / 8192–16000 (12–16 GB).
- По большей части значение зависит от вашего лора и фразбука, если в них много символов, то и значение нужно большое. (По моим подсчетам для ~20000 символов лора+фразбук нужно ~15000 контекста.

3) ngl (GPU-layers, «999» = максимум)
- Сколько слоёв модели держать на GPU. ↑ngl = ↑VRAM, но сильно быстрее. При OOM снижать.
- Средне: 999 (пусть сам возьмёт максимум). Если не лезет — 50–90.

4) batch-size
- Размер партии токенов на шаге. Влияет на пропускную способность и немного на VRAM.
- Средне: 128–256 (8 GB) / 256–384 (12–16 GB).

5) ubatch-size
- Подпартия, главный «жир» по VRAM. Первый рычаг при OOM/фризах.
- Средне: 24–48 (8 GB) / 64–96 (12–16 GB).

6) parallel
- Параллельные запросы к серверу. Для нескольких областей может ускорять, но VRAM растёт почти линейно.
- Средне: 1. Если 2 — урезать ubatch.

7) max_tokens (лимит ответа)
- Только на ответ, не на вход. ↑значение = дольше, чуть ↑память.
- Средне: 500–1000.

8) temperature
- Стохастичность. Для перевода держи низко (стабильность терминов).
- Средне: 0.00–0.25. (пробуйте с 0)

9) top_p
- Nucleus-сэмплинг. Чем ниже — тем консервативнее.
- Средне: 0.9–1. (пробуйте с 1)

10) top_k
- Сэмплинг по top-k токенам. Для перевода чаще 0 (выкл.).

11) repeat_penalty
- Штраф за повторы. Слегка ↑ для борьбы с заиканием.
- Средне: 1.00–1.08. (пробуйте с 1.00)

12) seed
- 0 = псевдослучайность каждый раз. Фиксируй (>0) для воспроизводимости.
- Средне: 0 (если не нужно «один-в-один»). (Для соло ставьте 1, для дуо 0)

13) timeout
- HTTP-таймаут запроса к серверу (сек).
- Средне: 12–18 s (под длину кадров/контекст).

14) FPS захвата
- Частота отправки кадров. ↑FPS = больше нагрузка, ↓латентность.
- Средне: 0.8–1.2. (чисто индивидульно, как часто вам нужно обновлять текст)

16) Режим вывода: instant / smooth
- instant — моментально
- smooth — печать по символам (имитация новел и гач).

### БЫСТРЫЕ ПРЕСЕТЫ:
8 GB VRAM: 
- ctx=6144
- batch=128
- ubatch=32
- parallel=1
- ngl=999
- max_tokens=400
- temp=0
- top_p=1.0
- top_k=0
- rep_pen=1.00
- timeout=12
- cache_prompt=ON
- FPS=1.0

12–16 GB VRAM:
- ctx=8192–12288+
- batch=256–384
- ubatch=64–96
- остальное как выше
- timeout=15.

### Что крутить при проблемах:
1) OOM/500 (ошибка в консоле)/фризы: снижать ubatch → batch → ctx (в таком порядке)
2) Медленно отвечает: снизить ctx или max_tokens, поднять batch (если есть VRAM)
3) Перевод «гуляет»: temperature вниз (до 0.15), top_k=0, repeat_penalty≈1.05, включить seed>0 (если нужна стабильность).
4) Слишком часто перезапускает вывод: повысить MIN_THUMB_DELTA или увеличить порог «Δ-символов для форс-обновления»(пока выключено).

### Попробуйте эти значения как у меня, так же прилагаю скрин нагрузки до и после запуска сервера (режим дуо: (Qwen-VL-2B + mmproj F16) + Qwen-4B (без VL))
#### Моё железо:
- I7 12700KF
- 32 ГБ ОЗУ
- RTX 4070 Ti Super

- соло
<img width="938" height="560" alt="image" src="https://github.com/user-attachments/assets/76c0c5cc-16ee-4efa-8184-ca4644db0d20" />

- дуо (чего нет, то как соло)
<img width="932" height="884" alt="image" src="https://github.com/user-attachments/assets/c88b3ff5-ddcf-412f-9c8d-c1a37538cc9f" />

### И нагрзука до и после
- до
<img width="1155" height="699" alt="Снимок экрана 2025-11-10 191704" src="https://github.com/user-attachments/assets/f7344b7d-bb10-4ce9-b233-1d08d5ae5574" />

- после
<img width="1163" height="704" alt="Снимок экрана 2025-11-10 191851" src="https://github.com/user-attachments/assets/4a569145-ef03-480e-a75f-70b5b723a89b" />


### Фууух, ну вроде все расписал, если что-то не понятно, нашли баг, есть предложение, создавайте issue, отвечу, прислушаюсь.
